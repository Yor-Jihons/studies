# 「テスト駆動開発」の要約

## 第1章 仮実装

Step1. あえてコンパイルの通らないコードでアウトラインを書く。

```C++
#include<iostream>
#include<cassert>

namespace std;

int main( void ){
    Test1::Class1 obj; // <- そもそもこのスコープにTest1::Class1クラスが無いのでコンパイルエラー。
    bool r = obj.Run(); // <- 上と同じ理由でここもコンパイルエラー。
    assert( r );

    int n = CONSTANT1 + 8; // <- #defineで定義した定数を使おうとしているがコンパイルエラー。

    // ...
}
```

Step2. そしてこのコードがコンパイル通るようにコードを書いていく。
つまり、``Test1::Class1``クラスや``Test1::Class1::Run``メンバ関数を実装し、``CONSTANT1``定数を定義する。
まずは``Test1::Class1``のコンストラクタが通るようにして、その次に``Test1::Class1::Run``メンバ関数を通す。
…とやっていく。フィールド(メンバ変数)が未定義の場合はそれらも追加していく。

次の段階で、``bool r = obj.Run();``のassert関数(マクロ)のステップで失敗する。
さらにそのステップも成功するようにコードを修正する。

Step3. 重複の除去を行う。

> TDDで大事なのは細かいステップを踏むことではなく、細かいステップを**踏み続けられる**ようにすること (p10)


```
[FLOW]
1. 小さいテストを1つ書く。
2. すべてのテストを実行し、1つ失敗することを確認する。
3. 小さい変更を行う。
4. 再びテストを実行し、すべて成功することを確認する。
5. リファクタリングを行い、重複を除去する。
```

## 第二章 明白な実装 Degenerate Objects

基本的には以下のようなサイクルになる。

```
1. テストを書く。大筋でもいいから頭の中で想像した操作がどんなコードとして現れるかを考える。
2. 動かす。テストがすべて通り、バーがグリーンになるように素早く実装する。このステップでは違反もスルーする。
3. 正しくする。
```

## 第三章 三角測量 Equality for All

Value Objectパターンと呼ばれるパターンを適用して、**コンストラクタで設定した値から変更されないようにする**ことも大事。

また、**三角測量**と呼ばれる実装戦略で行うべきである。恐らく抽象化のことだろう。

## 第四章 意図を語るテスト Privacy

```C++
// コード1

Class1* obj1 = new Class1(10);
Class1* obj2 = obj1.times(2);
assert( obj1.amount == 20 );
```

```C++
// コード2

Class1* obj1 = new Class1(10);
Class1* obj2 = obj1.times(2);
assert( obj1.Equals( new Class1(20) ) );
```

コード1のような直接値を出すようなコードよりも、コード2のようにオブジェクト化して**意図を明確にする**べきである。
こうすることでClass1が持つメンバ変数amountをprivateにできる。
これにより、更にコード3のようにobj2すら生成しなくて済む。

```C++
// コード2

Class1* obj1 = new Class1(10);
//obj1.times(2); // <- 不要なコード
assert( obj1.times(2).Equals( new Class1(20) ) );
```

この時点では「もしこのロジック自体が間違っている場合はすべて間違っている」というリスクがあるが、**あえてこのリスクを受け入れることも大事***である。

## 第五章 原則をあえて破るとき Franc-ly Speaking

通常「コピペをするな、継承等を使え」と言われるがここでは**あえてその原則を破る**。とりあえず動いてグリーンにするコードにする。

## 第六章 テスト不足に気づいたら Equality for All, Redux

テスト不足を恐れなくていい。気づいた時点でテストを追加すればいいだけだから。

## 第七章 疑念をテストに翻訳する Apples and Oranges

DollarクラスとFranc(フラン)クラスの比較といった処理のようにうまくいくかどうか、どのように実装すべきか悩むようなものもテスト対象に組み込む。
つまり、**頭の中にある悩みをテストにも反映させる**。

## 第八章 実装を隠す Makin' Objects

FactoryMethodパターンやポリモーフィズムを利用して実装を隠蔽する。

